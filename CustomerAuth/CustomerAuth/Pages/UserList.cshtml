@page
@model CustomerAuth.Pages.UserListModel
@{
    ViewData["Title"] = "User List";
}

<div class="container">
    <h2 class="glow-text">All Users</h2>

    <table class="user-table">
        <thead>
            <tr>
                <th>Profile</th>
                <th>Full Name</th>
                <th>Email</th>
                <th>Username</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var user in Model.Users)
            {
                <tr class="@((user.IsBlocked) ? "blocked" : "")">
                    <td>
                        <img src="@(user.ProfileImagePath != null ? "/uploads/" + user.ProfileImagePath : "/images/default-user.png")" class="profile-thumb" />
                    </td>
                    <td>@user.First_name @user.Last_name</td>
                    <td>@user.Email</td>
                    <td>@user.username</td>
                    <td>@(user.IsBlocked ? "Blocked" : "Active")</td>
                    <td>
                        <button class="btn btn-glow" onclick="openEditModal(@user.id)">Edit</button>
                        <form method="post" asp-page-handler="ToggleBlock" asp-route-id="@user.id" style="display:inline">
                            <button class="btn btn-glow">@((user.IsBlocked) ? "Unblock" : "Block")</button>
                        </form>
                        <form method="post" asp-page-handler="Delete" asp-route-id="@user.id" style="display:inline">
                            <button class="btn btn-danger-glow">Delete</button>
                        </form>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<!-- Edit Modal -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeEditModal()">&times;</span>
        <h3>Edit User</h3>
        <form method="post" enctype="multipart/form-data" asp-page-handler="Edit">
            <input type="hidden" name="EditUserId" id="EditUserId" />
            <div class="form-group">
                <label>First Name</label>
                <input type="text" name="First_name" id="EditFirstName" class="form-control" required />
            </div>
            <div class="form-group">
                <label>Last Name</label>
                <input type="text" name="Last_name" id="EditLastName" class="form-control" required />
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" name="Email" id="EditEmail" class="form-control" required />
            </div>
            <div class="form-group">
                <label>Username</label>
                <input type="text" name="username" id="EditUsername" class="form-control" required />
            </div>
            <div class="form-group">
                <label>Profile Image</label>
                <input type="file" name="ProfileImage" class="form-control" />
            </div>
            <button type="submit" class="btn btn-glow">Save Changes</button>
        </form>
    </div>
</div>

<style>
    .user-table {
        width: 100%;
        border-collapse: collapse;
    }

        .user-table th, .user-table td {
            padding: 10px;
            border-bottom: 1px solid #333;
            text-align: center;
        }

    .profile-thumb {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        object-fit: cover;
    }

    .blocked {
        background-color: #2a2a2a;
        color: #ff4c4c;
    }

    .btn-glow {
        padding: 5px 10px;
        background: #00f0ff;
        color: #000;
        border: none;
        border-radius: 5px;
        box-shadow: 0 0 10px #00f0ff;
        cursor: pointer;
    }

    .btn-danger-glow {
        padding: 5px 10px;
        background: #ff4c4c;
        color: #fff;
        border: none;
        border-radius: 5px;
        box-shadow: 0 0 10px #ff4c4c;
        cursor: pointer;
    }

    .glow-text {
        color: #00f0ff;
        text-shadow: 0 0 10px #00f0ff;
    }

    /* Modal Styles */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.7);
    }

    .modal-content {
        background-color: #1e1e1e;
        margin: 10% auto;
        padding: 20px;
        border-radius: 10px;
        width: 400px;
        color: #fff;
    }

    .close {
        color: #fff;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }

        .close:hover {
            color: #ff4c4c;
        }
</style>

<script>
    function openEditModal(id) {
        const user = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Users));
        const selected = user.find(u => u.id === id);
        if (!selected) return;

        document.getElementById("EditUserId").value = selected.id;
        document.getElementById("EditFirstName").value = selected.first_name;
        document.getElementById("EditLastName").value = selected.last_name;
        document.getElementById("EditEmail").value = selected.email;
        document.getElementById("EditUsername").value = selected.username;

        document.getElementById("editModal").style.display = "block";
    }

    function closeEditModal() {
        document.getElementById("editModal").style.display = "none";
    }
</script>
